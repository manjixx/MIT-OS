# Pointers and Arrays

**æŒ‡é’ˆæ˜¯ä¸€ç§ä¿å­˜å˜é‡åœ°å€çš„å˜é‡**ã€‚åœ¨ C è¯­è¨€ä¸­ï¼ŒæŒ‡é’ˆçš„ä½¿ç”¨éå¸¸å¹¿æ³›:

- åŸå› ä¹‹ä¸€æ˜¯ï¼ŒæŒ‡é’ˆå¸¸å¸¸æ˜¯è¡¨è¾¾æŸä¸ªè®¡ç®—çš„æƒŸä¸€é€”å¾„
- å¦ä¸€ä¸ªåŸå› æ˜¯ï¼ŒåŒå…¶å®ƒæ–¹æ³•æ¯”è¾ƒèµ·æ¥ï¼Œä½¿ç”¨æŒ‡é’ˆé€šå¸¸å¯ä»¥ç”Ÿæˆæ›´é«˜æ•ˆã€æ›´ç´§å‡‘çš„ä»£ç ã€‚

ANSI C ä½¿ç”¨ç±»å‹ `void *`ï¼ˆæŒ‡å‘ void çš„æŒ‡é’ˆï¼‰ä»£æ›¿ `char *`ä½œä¸ºé€šç”¨æŒ‡é’ˆçš„ç±»å‹ã€‚

## 5.1 Pointers and Address

> **å†…å­˜ç»„ç»‡æ–¹å¼**

é€šå¸¸çš„æœºå™¨éƒ½æœ‰ä¸€ç³»åˆ—è¿ç»­ç¼–å·æˆ–ç¼–å€çš„å­˜å‚¨å•å…ƒï¼Œè¿‡äº›å­˜å‚¨å•å…ƒå¯ä»¥å•ä¸ªè¿›è¡Œæ“çºµï¼Œä¹Ÿå¯ä»¥ä»¥è¿ç»­æˆç»„çš„æ–¹å¼æ“çºµã€‚

é€šå¸¸æƒ…å†µä¸‹ï¼Œæœºå™¨çš„ä¸€ä¸ªå­—èŠ‚å¯ä»¥å­˜æ”¾ä¸€ä¸ª char ç±»å‹çš„æ•°æ®ï¼Œä¸¤ä¸ªç›¸é‚»çš„å­—èŠ‚å­˜å‚¨å•å…ƒå¯å­˜å‚¨ä¸€ä¸ª shortï¼ˆçŸ­æ•´å‹ï¼‰ç±»å‹çš„æ•°æ®ï¼Œè€Œ 4 ä¸ªç›¸é‚»çš„å­—èŠ‚å­˜å‚¨å•å…ƒå¯å­˜å‚¨ä¸€ä¸ª longï¼ˆé•¿æ•´å‹ï¼‰ç±»å‹çš„æ•°æ®ã€‚

æŒ‡é’ˆæ˜¯èƒ½å¤Ÿå­˜æ”¾ä¸€ä¸ªåœ°å€çš„ä¸€ç»„å­˜å‚¨å•å…ƒï¼ˆé€šå¸¸æ˜¯ä¸¤ä¸ªæˆ– 4 ä¸ªå­—èŠ‚ï¼‰ã€‚

> è¿ç®—ç¬¦ & å’Œ è¿ç®—ç¬¦ *

- ä¸€å…ƒè¿ç®—ç¬¦ `&`å¯ç”¨äºå–ä¸€ä¸ªå¯¹è±¡çš„åœ°å€ã€‚**åªèƒ½åº”ç”¨äºå†…å­˜ä¸­çš„å¯¹è±¡**ï¼Œå³å˜é‡ä¸æ•°ç»„å…ƒç´ ã€‚**å®ƒä¸èƒ½ä½œç”¨äº**è¡¨è¾¾å¼ã€å¸¸é‡æˆ– register ç±»å‹çš„å˜é‡ã€‚
- ä¸€å…ƒè¿ç®—ç¬¦`*`æ˜¯**é—´æ¥å¯»å€**æˆ–**é—´æ¥å¼•ç”¨è¿ç®—ç¬¦**ã€‚å½“å®ƒä½œç”¨äºæŒ‡é’ˆæ—¶ï¼Œå°†è®¿é—®æŒ‡é’ˆæ‰€æŒ‡å‘çš„å¯¹è±¡ã€‚

ğŸ™‹ğŸŒ°è¯´æ˜

```c
int x = 1, y = 2, z[10];
int *ip;    /* ip is a pointer to int */

ip = &x;    /* ip now points to x */
y = *ip;    /* y is now 1 */
*ip = 0;    /* x is now 0 */
ip = &z[0]; /* ip now points to z[0] */
```

> **æŒ‡é’ˆçš„å£°æ˜**

æ³¨æ„ï¼š

- **æŒ‡é’ˆåªèƒ½æŒ‡å‘æŸç§ç‰¹å®šç±»å‹çš„å¯¹è±¡**ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªæŒ‡é’ˆéƒ½å¿…é¡»æŒ‡å‘æŸç§ç‰¹å®šçš„æ•°æ®ç±»å‹ã€‚

- ä¸€ä¸ªä¾‹å¤–æƒ…å†µæ˜¯**æŒ‡å‘ void ç±»å‹çš„æŒ‡é’ˆå¯ä»¥å­˜æ”¾æŒ‡å‘ä»»ä½•ç±»å‹çš„æŒ‡é’ˆ**ï¼Œä½†å®ƒä¸èƒ½é—´æ¥å¼•ç”¨å…¶è‡ªèº«

```c
int *ip;
/* åœ¨è¡¨è¾¾å¼ä¸­ï¼Œ*dp å’Œ atof(s)çš„å€¼éƒ½æ˜¯ double ç±»å‹ï¼Œä¸” atof çš„å‚æ•°æ˜¯ä¸€ä¸ªæŒ‡å‘ char ç±»å‹çš„æŒ‡é’ˆã€‚ */
double *dp, atof(char *);
```

```c
/* *ip çš„å€¼åŠ  10 */
*ip = *ip + 10;

/**
 points1: ä¸€å…ƒè¿ç®—ç¬¦*å’Œ&çš„ä¼˜å…ˆçº§æ¯”ç®—æœ¯è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§é«˜
 */

y = *ip + 1; /*å°† *ipæŒ‡å‘çš„å¯¹è±¡çš„å€¼å–å‡ºæ¥å¹¶åŠ 1ï¼Œç„¶åå†èµ‹å€¼ç»™y */

/* ä¸‹åˆ—ä¸‰å¥å‡ä¸ºå°† *ipæŒ‡å‘çš„å¯¹è±¡å–å‡ºæ¥å¹¶åŠ 1 */
*ip += 1;
++ *ip;
(*ip) ++; /*æ³¨æ„è¯¥å¥ä¸­()æ˜¯å¿…é¡»çš„ï¼Œå› ä¸º * ä¸ ++ ä¸€å…ƒè¿ç®—ç¬¦éµå¾ªä»å·¦åˆ°å³çš„ç»“åˆé¡ºåº */

/**
    points2:ç”±äºæŒ‡é’ˆä¹Ÿæ˜¯å˜é‡ï¼Œæ‰€ä»¥åœ¨ç¨‹åºä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œè€Œä¸å¿…é€šè¿‡é—´æ¥å¼•ç”¨çš„æ–¹æ³•ä½¿ç”¨ã€‚
 */

iq = ip; /*è¡¨ç¤ºå°†ipä¸­çš„å€¼æ‹·è´åˆ°iqä¸­ï¼Œiqä¹Ÿå°†æŒ‡å‘iqæŒ‡å‘çš„å¯¹è±¡ */

```

***

## 5.2 Pointers and Function Arguments

ç”±äº C è¯­è¨€æ˜¯ä»¥ä¼ å€¼çš„æ–¹å¼å°†å‚æ•°å€¼ä¼ é€’ç»™è¢«è°ƒç”¨å‡½æ•°ã€‚å› æ­¤ï¼Œ**è¢«è°ƒç”¨å‡½æ•°ä¸èƒ½ç›´æ¥ä¿®æ”¹ä¸»è°ƒå‡½æ•°ä¸­å˜æœ€çš„å€¼**ã€‚

> swapå‡½æ•°ä¸ºä¾‹

```c
/**wrong
    ç”±äºå‚æ•°ä¼ é€’é‡‡ç”¨ä¼ å€¼æ–¹å¼ï¼Œå› æ­¤ä¸Šè¿°çš„ swap å‡½æ•°ä¸ä¼šå½±å“åˆ°è°ƒç”¨å®ƒçš„ä¾‹ç¨‹ä¸­çš„å‚æ•° a å’Œ b çš„å€¼ã€‚è¯¥å‡½æ•°ä»…ä»…äº¤æ¢äº† a å’Œ b çš„å‰¯æœ¬çš„å€¼ã€‚
*/

void swap(int x, int y){
    int temp;

    temp = x;
    x = y;
    y = temp;
}
```

```c
/**
    right
    å°†æŒ‡å‘æ‰€è¦äº¤æ¢çš„å˜é‡çš„æŒ‡é’ˆä¼ é€’ç»™è¢«è°ƒç”¨å‡½æ•°
 */

swap(&a, &b);

void swap(int *px, int *py){
    int temp;

    temp = *px;
    *px = *py;
    *py = temp;
}
```

***

## 5.3 Pointers and Arrays

é€šè¿‡**æ•°ç»„ä¸‹æ ‡æ‰€èƒ½å®Œæˆçš„ä»»ä½•æ“ä½œéƒ½å¯ä»¥é€šè¿‡æŒ‡é’ˆæ¥å®ç°**ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œç”¨æŒ‡é’ˆç¼–å†™çš„ç¨‹åºæ¯”ç”¨æ•°ç»„ä¸‹æ ‡ç¼–å†™çš„ç¨‹åºæ‰§è¡Œé€Ÿåº¦å¿«ï¼Œä½†å¦ä¸€æ–¹é¢ï¼Œç”¨æŒ‡é’ˆå®ç°çš„ç¨‹åºç†è§£èµ·æ¥ç¨å¾®å›°éš¾ä¸€äº›ã€‚

> **æ•°ç»„çš„å£°æ˜**

```c
int a[10]; // å®šä¹‰äº†ä¸€ä¸ªç”± 10 ä¸ªå¯¹è±¡ç»„æˆçš„é›†åˆï¼Œè¿™ 10 ä¸ªå¯¹è±¡å­˜å‚¨åœ¨ç›¸é‚»çš„å†…å­˜åŒºåŸŸä¸­ï¼Œåå­—åˆ†åˆ«ä¸º a[0]ã€a[1]ã€â€¦ã€a[9]
```

> **å£°æ˜ä¸€ä¸ªæŒ‡å‘æ•´å‹å¯¹è±¡çš„æŒ‡é’ˆå¹¶å°†å…¶æŒ‡å‘æ•°ç»„açš„ç¬¬0ä¸ªå…ƒç´ **

```c
int *pa
pa = &a[0];

/*å°†æ•°ç»„å…ƒç´ a[0]ä¸­çš„å†…å®¹å¤åˆ¶åˆ°å˜é‡xä¸­*/
x = *pa;
```

> **ä¸€ä¸ªé€šè¿‡æ•°ç»„å’Œä¸‹æ ‡å®ç°çš„è¡¨è¾¾å¼å¯ç­‰ä»·åœ°é€šè¿‡æŒ‡é’ˆå’Œåç§»é‡å®ç°ã€‚**

- æ ¹æ®æŒ‡é’ˆè¿ç®—çš„å®šä¹‰`pa + 1`å°†æŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆ`*(pa+1)`å¼•ç”¨çš„æ˜¯æ•°ç»„å…ƒç´ `a[1]`çš„å†…å®¹;

- `pa + i`å°†æŒ‡å‘`pa`æ‰€æŒ‡å‘æ•°ç»„å…ƒç´ ä¹‹åçš„ç¬¬`i`ä¸ªå…ƒç´ ,`*(pa+i)`å¼•ç”¨çš„æ˜¯æ•°ç»„å…ƒç´  `a[i]`çš„å†…å®¹

æœ‰ä¸Šè¿°å†…å®¹å¯çŸ¥`pa = &a[0]`ï¼Œæ­¤æ—¶`pa`ä¸`a`å…·æœ‰ç›¸åŒçš„å€¼ï¼Œå› ä¸º**æ•°ç»„åä»£è¡¨çš„å°±æ˜¯è¯¥æ•°ç»„æœ€å¼€å§‹çš„ä¸€ä¸ªå…ƒç´ çš„åœ°å€**ï¼Œæ‰€ä»¥èµ‹å€¼è¯­å¥`pa = &a[0]`ä¹Ÿå¯ä»¥å†™ä¸º`pa = a`

- **å¯¹æ•°ç»„å…ƒç´  `a[i]`çš„å¼•ç”¨ä¹Ÿå¯ä»¥å†™æˆ`*(a+i)`è¿™ç§å½¢å¼**,å®é™…ä¸Šåœ¨è®¡ç®—æ•°ç»„å…ƒç´  a[i]çš„å€¼æ—¶ï¼ŒC è¯­è¨€å®é™…ä¸Šå…ˆå°†å…¶è½¬æ¢ä¸º`*(a+i)`çš„å½¢å¼ï¼Œç„¶åå†è¿›è¡Œæ±‚å€¼
  
- `&a[i]`å’Œ `a+i`çš„å«ä¹‰ä¹Ÿæ˜¯ç›¸åŒçš„ã€‚`a+i` æ˜¯ `a`ä¹‹åç¬¬ `i` ä¸ªå…ƒç´ çš„åœ°å€

- ç›¸åº”åœ°ï¼Œå¦‚æœ `pa` æ˜¯ä¸ªæŒ‡é’ˆï¼Œé‚£ä¹ˆï¼Œåœ¨è¡¨è¾¾å¼ä¸­ä¹Ÿå¯ä»¥åœ¨å®ƒçš„åé¢åŠ ä¸‹æ ‡ã€‚`pa[i]`ä¸`*(pa+i)`æ˜¯ç­‰ä»·çš„ã€‚

> **æ³¨æ„**

æ•°ç»„åå’ŒæŒ‡é’ˆä¹‹é—´æœ‰ä¸€ä¸ªä¸åŒä¹‹å¤„ï¼Œ**æŒ‡é’ˆæ˜¯ä¸€ä¸ªå˜é‡**ã€‚å› æ­¤

- åœ¨ `C`è¯­è¨€ä¸­ï¼Œè¯­å¥ `pa=a` å’Œ `pa++`éƒ½æ˜¯åˆæ³•çš„ã€‚
- ä½†æ•°ç»„åä¸æ˜¯å˜é‡ï¼Œå› æ­¤ï¼Œç±»ä¼¼äº `a=pa` å’Œ `a++`å½¢å¼çš„è¯­å¥æ˜¯éæ³•çš„ã€‚

> **æ•°ç»„ä½œä¸ºå‡½æ•°å‚æ•°**

å½“æŠŠæ•°ç»„åä¼ é€’ç»™ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œå®é™…ä¸Šä¼ é€’çš„æ˜¯è¯¥æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´¢çš„åœ°å€ã€‚**ä¸‹åˆ—ä¸¤ç§å½¢å¼å‚æ•°æ˜¯ä¸€æ ·çš„ï¼Œ**æˆ‘ä»¬é€šå¸¸**æ›´ä¹ æƒ¯äºä½¿ç”¨åä¸€ç§å½¢å¼**ï¼Œå› ä¸ºå®ƒæ¯”å‰è€…æ›´ç›´è§‚åœ°è¡¨æ˜äº†è¯¥å‚æ•°æ˜¯ä¸€ä¸ªæŒ‡é’ˆã€‚

```c
void fun(char[] s){}

void fun(char *s){}

void fun(int[] arr){}

void fun(int *arr){}

/* å°†æŒ‡å‘å­æ•°ç»„èµ·å§‹ä½ç½®çš„æŒ‡é’ˆä¼ é€’ç»™å‡½æ•°ï¼Œè¿™æ ·ï¼Œå°±å°†æ•°ç»„çš„ä¸€éƒ¨åˆ†ä¼ é€’ç»™äº†å‡½æ•°ã€‚ 
  ä¸‹é¢ä¸¤ä¸ªå‡½æ•°è°ƒç”¨ï¼Œéƒ½å°†æŠŠèµ·å§‹äº a[2]çš„å­æ•°ç»„çš„åœ°å€ä¼ é€’ç»™å‡½æ•° f
*/

f(&a[2]);
f(a + 2);

```

***

## 5.4 Address Arithmetic(åœ°å€ç®—æœ¯è¿ç®—)

C è¯­è¨€ä¸­çš„åœ°å€ç®—æœ¯è¿ç®—æ–¹æ³•æ˜¯**ä¸€è‡´ä¸”æœ‰è§„å¾‹çš„**ï¼Œå°†**æŒ‡é’ˆã€æ•°ç»„å’Œåœ°å€çš„ç®—æœ¯è¿ç®—é›†æˆåœ¨ä¸€èµ·**æ˜¯è¯¥è¯­è¨€çš„ä¸€å¤§ä¼˜ç‚¹ã€‚

> **ä¾‹å­:ä¸å®Œå–„çš„å­˜å‚¨åˆ†é…ç¨‹åº**

ä¹‹æ‰€ä»¥è¯´è¿™ä¸¤ä¸ªå‡½æ•°æ˜¯ **â€œä¸å®Œå–„çš„â€**ï¼Œæ˜¯å› ä¸ºå¯¹ `afree` å‡½æ•°çš„è°ƒç”¨æ¬¡åºå¿…é¡»ä¸è°ƒç”¨`alloc` å‡½æ•°çš„æ¬¡åºç›¸åã€‚æ¢å¥è¯è¯´ï¼Œ`alloc`ä¸`afree` ä»¥**æ ˆçš„æ–¹å¼ï¼ˆå³åè¿›å…ˆå‡ºçš„åˆ—è¡¨ï¼‰è¿›è¡Œå­˜å‚¨ç©ºé—´çš„ç®¡ç†**ã€‚

**å®ç°ç»†èŠ‚ï¼š**

- è®© `alloc` å‡½æ•°**å¯¹ä¸€ä¸ªå¤§å­—ç¬¦æ•°ç»„ `allocbuf` ä¸­çš„ç©ºé—´è¿›è¡Œåˆ†é…**ã€‚è¯¥æ•°ç»„æ˜¯ `alloc` å’Œ `afree` ä¸¤ä¸ªå‡½æ•°**ç§æœ‰çš„æ•°ç»„**ã€‚ç”±äºå‡½æ•° `alloc` å’Œ `afree` å¤„ç†çš„å¯¹è±¡æ˜¯æŒ‡é’ˆè€Œä¸æ˜¯æ•°ç»„ä¸‹æ ‡ï¼Œå› æ­¤ï¼Œå…¶å®ƒå‡½æ•°æ— éœ€çŸ¥é“è¯¥æ•°ç»„çš„åå­—ï¼Œè¿™æ ·ï¼Œå¯ä»¥åœ¨åŒ…å«`alloc`å’Œ`afree`çš„æºæ–‡ä»¶ä¸­å°†è¯¥æ•°ç»„å£°æ˜ä¸º `static` ç±»å‹ï¼Œä½¿å¾—å®ƒå¯¹å¤–ä¸å¯è§ã€‚å®é™…å®ç°æ—¶ï¼Œè¯¥æ•°ç»„ç”šè‡³å¯ä»¥æ²¡æœ‰åå­—ï¼Œå®ƒå¯ä»¥é€šè¿‡è°ƒç”¨`malloc` å‡½æ•°æˆ–å‘æ“ä½œç³»ç»Ÿç”³è¯·ä¸€ä¸ªæŒ‡å‘æ— åå­˜å‚¨å—çš„æŒ‡é’ˆè·å¾—ã€‚
- éœ€è¦æŒæ¡`allocbuf`ä½¿ç”¨æƒ…å†µï¼Œæˆ‘ä»¬ä½¿ç”¨æŒ‡é’ˆ`allocp`æŒ‡å‘`allocbuf`ä¸­çš„ä¸‹ä¸€ä¸ªç©ºé—²å•å…ƒã€‚
- å¦‚æœ `p` åœ¨ `allocbuf` çš„è¾¹ç•Œä¹‹å†…ï¼Œåˆ™ `afree(p)`ä»…ä»…åªæ˜¯å°†`allocp` çš„å€¼è®¾ç½®ä¸º`p`ã€‚
- `C` è¯­è¨€ä¿è¯ï¼Œ`0` æ°¸è¿œä¸æ˜¯æœ‰æ•ˆçš„æ•°æ®åœ°å€ï¼Œå› æ­¤ï¼Œè¿”å›å€¼ `0` å¯ç”¨æ¥è¡¨ç¤ºå‘ç”Ÿäº†å¼‚å¸¸äº‹ä»¶ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œè¿”å›å€¼`0` è¡¨ç¤ºæ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—²ç©ºé—´å¯ä¾›åˆ†é…ã€‚
  
```c
#define ALLOCSIZE 10000 /* size of available space */
static char allocbuf[ALLOCSIZE]; /* storage for alloc */
static char *allocp = allocbuf; /* next free position */

/*è¿”å›ä¸€ä¸ªæŒ‡å‘ n ä¸ªè¿ç»­å­—ç¬¦å­˜å‚¨å•å…ƒçš„æŒ‡é’ˆ */
char *alloc(int n) 
{   /*æ£€æŸ¥allocbufæ˜¯å¦æœ‰è¶³å¤Ÿçš„åœ°å€ */
    if (allocbuf + ALLOCSIZE - allocp >= n) { /*its fit */
        allocp += n; /* å°†allocpæŒ‡å‘ä¸‹ä¸€ä¸ªç©ºé—²åŒºåŸŸ*/
        return allocp - n; /* è¿”å›allocp å½“å‰å€¼ï¼Œold p */
    } else /* not enough room */
        return 0;
}

/* free storage pointed to by p */
void afree(char *p) 
{
    if (p >= allocbuf && p < allocbuf + ALLOCSIZE)
        allocp = p;
}
```

> **æŒ‡é’ˆçš„åˆå§‹åŒ–**

å¯¹æŒ‡é’ˆæœ‰æ„ä¹‰çš„åˆå§‹åŒ–å€¼åªèƒ½æ˜¯ `0` æˆ–è€…æ˜¯**è¡¨ç¤ºåœ°å€çš„è¡¨è¾¾å¼**ï¼Œå¯¹åè€…æ¥è¯´ï¼Œè¡¨è¾¾å¼æ‰€ä»£è¡¨çš„åœ°å€å¿…é¡»æ˜¯åœ¨æ­¤å‰**å·²å®šä¹‰**çš„å…·æœ‰**é€‚å½“ç±»å‹çš„æ•°æ®çš„åœ°å€**ã€‚

> **æœ‰æ•ˆçš„æŒ‡é’ˆè¿ç®—**

- **ç›¸åŒç±»å‹æŒ‡é’ˆä¹‹é—´çš„èµ‹å€¼è¿ç®—**ï¼›
- **æŒ‡é’ˆåŒæ•´æ•°ä¹‹é—´**çš„åŠ æ³•æˆ–å‡æ³•è¿ç®—ï¼›
  - åœ¨è®¡ç®— `p+n` æ—¶ï¼Œ`n` å°†æ ¹æ® `p` æŒ‡å‘çš„å¯¹è±¡çš„é•¿åº¦æŒ‰æ¯”ä¾‹ç¼©æ”¾ï¼Œè€Œ `p` æŒ‡å‘çš„å¯¹è±¡çš„é•¿åº¦åˆ™å–å†³äº `p` çš„å£°æ˜ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ `int` ç±»å‹å  `4` ä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´ï¼Œé‚£ä¹ˆåœ¨ `int` ç±»å‹çš„è®¡ç®—ä¸­ï¼Œå¯¹åº”çš„ `n` å°†æŒ‰ `4`çš„å€æ•°æ¥è®¡ç®—ã€‚
- æŒ‡å‘**ç›¸åŒæ•°ç»„ä¸­å…ƒç´ çš„ä¸¤ä¸ªæŒ‡é’ˆé—´çš„å‡æ³•æˆ–æ¯”è¾ƒè¿ç®—**ï¼›
  - æŒ‡é’ˆ `p` å’Œ `q` æŒ‡å‘åŒä¸€ä¸ªæ•°ç»„çš„æˆå‘˜ï¼Œé‚£ä¹ˆå®ƒä»¬ä¹‹é—´å°±å¯ä»¥è¿›è¡Œç±»ä¼¼äº`==ã€!=ã€<ã€>=`çš„å…³ç³»æ¯”è¾ƒè¿ç®—
  - å¦‚æœ `p` å’Œ `q` æŒ‡å‘ç›¸åŒæ•°ç»„ä¸­çš„å…ƒç´¢ï¼Œä¸” `p<q`ï¼Œé‚£ä¹ˆ `q-p+1`å°±æ˜¯ä½äº `p` å’Œ `q` æŒ‡å‘ä¹‹é—´çš„å…ƒç´ çš„æ•°ç›®
- å°†æŒ‡é’ˆèµ‹å€¼ä¸º 0 æˆ–æŒ‡é’ˆä¸ 0 ä¹‹é—´çš„æ¯”è¾ƒè¿ç®—ã€‚ç¨‹åºä¸­ç»å¸¸ç”¨ç¬¦å·å¸¸é‡ `NULL` ä»£æ›¿å¸¸é‡ `0`ï¼Œè¿™æ ·ä¾¿äºæ›´æ¸…æ™°åœ°è¯´æ˜å¸¸é‡`0` æ˜¯æŒ‡é’ˆçš„ä¸€ä¸ªç‰¹æ®Šå€¼ã€‚

**æŒ‡é’ˆçš„ç®—æœ¯è¿ç®—å…·æœ‰ä¸€è‡´æ€§**ï¼šå¦‚æœå¤„ç†çš„æ•°æ®ç±»å‹æ˜¯æ¯”å­—ç¬¦å‹å æ®æ›´å¤šå­˜å‚¨ç©ºé—´çš„æµ®ç‚¹ç±»å‹ï¼Œå¹¶ä¸” p æ˜¯ä¸€ä¸ªæŒ‡å‘æµ®ç‚¹ç±»å‹çš„æŒ‡é’ˆï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œ p++åï¼Œp å°†æŒ‡å‘ä¸‹ä¸€ä¸ªæµ®ç‚¹æ•°çš„åœ°å€ã€‚

> **éæ³•çš„æŒ‡é’ˆè¿ç®—ä¸¾ä¾‹**

- ä¸¤ä¸ªæŒ‡é’ˆé—´çš„åŠ æ³•ã€ä¹˜æ³•ã€é™¤æ³•ã€ç§»ä½æˆ–å±è”½è¿ç®—ï¼›
- æŒ‡é’ˆåŒ float æˆ– double ç±»å‹ä¹‹é—´çš„åŠ æ³•è¿ç®—ï¼›
- ä¸ç»å¼ºåˆ¶ç±»å‹è½¬æ¢è€Œç›´æ¥å°†æŒ‡å‘ä¸€ç§ç±»å‹å¯¹è±¡çš„æŒ‡é’ˆèµ‹å€¼ç»™æŒ‡å‘å¦ä¸€ç§ç±»å‹å¯¹è±¡çš„æŒ‡é’ˆçš„è¿ç®—ï¼ˆä¸¤ä¸ªæŒ‡é’ˆä¹‹ä¸€æ˜¯ void *ç±»å‹çš„æƒ…å†µé™¤å¤–ï¼‰ã€‚

***

## 5.5 Character Pointers and Functions

### 5.5.1 å­—ç¬¦ä¸²å¸¸é‡

**å­—ç¬¦ä¸²å¸¸é‡æ˜¯ä¸€ä¸ªå­—ç¬¦æ•°ç»„**ï¼Œä¾‹å¦‚ï¼š`"I am a string"` åœ¨å­—ç¬¦ä¸²çš„å†…éƒ¨è¡¨ç¤ºä¸­ï¼Œå­—ç¬¦æ•°ç»„ä»¥ç©ºå­—ç¬¦'\0'ç»“å°¾ï¼Œæ‰€ä»¥ï¼Œç¨‹åºå¯ä»¥é€šè¿‡æ£€æŸ¥ç©ºå­—ç¬¦æ‰¾åˆ°å­—ç¬¦æ•°ç»„çš„ç»“å°¾ã€‚å­—ç¬¦ä¸²å¸¸é‡å æ®çš„å­˜å‚¨å•å…ƒæ•°ä¹Ÿå› æ­¤æ¯”åŒå¼•å·å†…çš„å­—ç¬¦æ•°å¤§ 1ã€‚

### 5.5.2 å­—ç¬¦ä¸²å¸¸é‡å¸¸è§çš„ç”¨æ³•

> **ä½œä¸ºå‡½æ•°å‚æ•°**

`printf("hello, world\n"};`

å½“ç±»ä¼¼äºè¿™æ ·çš„ä¸€ä¸ªå­—ç¬¦ä¸²å‡ºç°åœ¨ç¨‹åºä¸­æ—¶ï¼Œå®é™…ä¸Šæ˜¯é€šè¿‡å­—ç¬¦æŒ‡é’ˆè®¿é—®è¯¥å­—ç¬¦ä¸²ã€‚åœ¨ä¸Šè¿°è¯­å¥ä¸­ï¼Œ`printf` æ¥å—çš„**æ˜¯ä¸€ä¸ªæŒ‡å‘å­—ç¬¦æ•°ç»„ç¬¬ä¸€ä¸ªå­—ç¬¦çš„æŒ‡é’ˆ**ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå­—ç¬¦ä¸²å¸¸é‡å¯é€šè¿‡ä¸€ä¸ªæŒ‡å‘å…¶ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆè®¿é—®ã€‚

> **å®šä¹‰æŒ‡å‘å­—ç¬¦ä¸²çš„æŒ‡é’ˆ**

```c
char *pmessage;
/**å°†æŒ‡å‘è¯¥å­—ç¬¦æ•°ç»„çš„æŒ‡é’ˆèµ‹ç»™æŒ‡é’ˆpmessage */
pmessage = "now is the time"
```

- æ³¨æ„ä¸‹åˆ—ä¸¤ä¸ªå®šä¹‰é—´å­˜åœ¨å¾ˆå¤§å·®åˆ«

```c
char amessage[] = "nw is the time"; /* å®šä¹‰ä¸€ä¸ªæ•°ç»„ */
char *pmessage = "now is the time"; /* å®šä¹‰ä¸€ä¸ªæŒ‡é’ˆ */
```

- amessage
  - `amessage` æ˜¯ä¸€ä¸ªä»…ä»…è¶³ä»¥å­˜æ”¾åˆå§‹åŒ–å­—ç¬¦ä¸²ä»¥åŠç©ºå­—ç¬¦'\0'çš„ä¸€ç»´æ•°ç»„ã€‚
  - æ•°ç»„ä¸­çš„å•ä¸ªå­—ç¬¦å¯ä»¥è¿›è¡Œä¿®æ”¹å§‹ç»ˆåªèƒ½æŒ‡å‘åŒä¸€ä¸ªå­˜å‚¨ä½ç½®

- pmessage
  - pmessageæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå…¶åˆå€¼æŒ‡å‘ä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡,ä¹‹å`pmessage`å¯ä»¥è¢«ä¿®æ”¹ä»¥æŒ‡å‘å…¶å®ƒåœ°å€
  - ä½†å­—ç¬¦ä¸²çš„å†…å®¹æ— æ³•è¢«ä¿®æ”¹ï¼Œç»“æœæ˜¯æ²¡æœ‰å®šä¹‰çš„

> **strcpå‡½æ•°**

å‡½æ•°åŠŸèƒ½ï¼šæŠŠæŒ‡é’ˆ `t` æŒ‡å‘çš„å­—ç¬¦ä¸²å¤åˆ¶åˆ°æŒ‡é’ˆ`s` æŒ‡å‘çš„ä½ç½®ã€‚

ç¬¬ä¸€ä¸ªç‰ˆæœ¬çš„`strcpy`å‡½æ•°ï¼šåˆ©ç”¨æ•°ç»„å®ç°
  
```c
/**
    åˆ©ç”¨æ•°ç»„æ–¹æ³•å®ç°
 */

/* strcpy: copy t to s; array subscript version */
void strcpy(char *s, char *t){
    int i;
    i = 0;
    while(s[i] = t[i] != '\0')
        i++;
}
```

ç¬¬äºŒä¸ªç‰ˆæœ¬çš„`strcpy`å‡½æ•°ï¼Œåˆ©ç”¨æŒ‡é’ˆå®ç°

- pointer version:æ”¹ä¸ºæŒ‡é’ˆ
- pointer version2: ç²¾ç®€ç‰ˆæœ¬ï¼Œs å’Œ t çš„è‡ªå¢è¿ç®—æ”¾åˆ°äº†å¾ªç¯çš„æµ‹è¯•éƒ¨åˆ†ä¸­ï¼Œåç¼€è¿ç®—ç¬¦`++`è¡¨ç¤ºåœ¨è¯»å–è¯¥å­—ç¬¦ä¹‹åæ‰æ”¹å˜ `t` çš„å€¼
- pointer version3: è¿›ä¸€æ­¥ç²¾ç®€ç‰ˆæœ¬ï¼Œè¡¨è¾¾å¼åŒ`'\0'`çš„æ¯”è¾ƒæ˜¯å¤šä½™çš„ï¼Œå› ä¸ºåªéœ€è¦åˆ¤æ–­è¡¨è¾¾å¼çš„å€¼æ˜¯å¦ä¸º 0 å³å¯ã€‚

```c
/**
 åˆ©ç”¨æŒ‡é’ˆæ–¹æ³•å®ç°
 */ 
/* strcpy: copy t to s; array pointer version */
void strcpy(char *s, char *t){
    while((*s = *t) != '\0'){
        s++;
        t++;
    }
}

/* strcpy: copy t to s; array pointer version2 */
void strcpy(char *s, char *t){
    while((*s++ = *t++) != '\0');
        ;
}

/* strcpy: copy t to s; array pointer version3 */
void strcpy(char *s, char *t){
    while(*s++ = *t++);
        ;
}
```

ç¬¬ä¸‰ä¸ªç‰ˆæœ¬çš„å‡½æ•°åˆçœ‹èµ·æ¥ä¸å¤ªå®¹æ˜“ç†è§£ï¼Œä½†è¿™ç§è¡¨ç¤ºæ–¹æ³•æ˜¯å¾ˆæœ‰å¥½å¤„çš„ï¼Œæˆ‘ä»¬åº”è¯¥æŒæ¡è¿™ç§æ–¹æ³•ï¼ŒC è¯­è¨€ç¨‹åºä¸­ç»å¸¸ä¼šé‡‡ç”¨è¿™ç§å†™æ³•ã€‚

æ ‡å‡†åº“ï¼ˆ<string.h>ï¼‰ä¸­æä¾›çš„å‡½æ•° strcpy æŠŠç›®æ ‡å­—ç¬¦ä¸²ä½œä¸ºå‡½æ•°å€¼è¿”å›

> **strcmp(s,t)**

**å‡½æ•°åŠŸèƒ½ï¼š**å­—ç¬¦ä¸²æ¯”è¾ƒå‡½æ•° strcmp(s, t)ã€‚è¯¥å‡½æ•°æ¯”è¾ƒå­—ç¬¦ä¸² s å’Œ tï¼Œå¹¶ä¸”æ ¹æ® s æŒ‰ç…§å­—å…¸é¡ºåºå°äºã€ç­‰äºæˆ–å¤§äº t çš„ç»“æœåˆ†åˆ«è¿”å›è´Ÿæ•´æ•°ã€0 æˆ–æ­£æ•´æ•°ã€‚è¯¥è¿”å›å€¼æ˜¯ `s` å’Œ `t` ç”±å‰å‘åé€å­—ç¬¦æ¯”è¾ƒæ—¶é‡åˆ°çš„ç¬¬ä¸€ä¸ªä¸ç›¸ç­‰å­—ç¬¦å¤„çš„å­—ç¬¦çš„å·®å€¼ã€‚

ç¬¬ä¸€ä¸ªç‰ˆæœ¬çš„å‡½æ•°ï¼šåˆ©ç”¨æ•°ç»„å®ç°

```c
/* strcmp: return <0 if s<t, 0 if s==t, >0 if s>t */
int strcmp(char *s, char *t)
{
    int i;
    for (i = 0; s[i] == t[i]; i++)
        if (s[i] == '\0')
            return 0;
        return s[i] - t[i];
}
```

ç¬¬äºŒä¸ªç‰ˆæœ¬çš„å‡½æ•°:åˆ©ç”¨æŒ‡é’ˆçš„æ–¹å¼å®ç°

```c
/* strcmp: return <0 if s<t, 0 if s==t, >0 if s>t */
int strcmp(char *s, char *t)
{
    for ( ; *s == *t; s++, t++)
        if (*s == '\0')
            return 0;
    return *s - *t;
}
```

> **æŒ‡é’ˆä¸è‡ªå¢è‡ªå‡è¿ç®—ç¬¦**

```c
*--p;   //  è¯»å–pæŒ‡é’ˆæŒ‡å‘çš„å­—ç¬¦ä¹‹å‰å…ˆå¯¹pæ‰§è¡Œè‡ªå‡è¿ç®—
*p--    // å…ˆè¯»å–pæŒ‡å‘çš„å†…å®¹ï¼Œè¯»å–åå¯¹æŒ‡é’ˆè¿›è¡Œè‡ªå¢è‡ªå»ºè¿ç®—

/**è¿›æ ˆå‡ºæ ˆçš„æ ‡å‡†ç”¨æ³•*/

*p++ = val; /* å°†valå‹å…¥æ ˆ */
val = *--p; /*å°†æ ˆé¡¶å…ƒç´ å¼¹å‡ºåˆ°val */
```

## 5.6 Pointer Arrays; Pointers to Pointers

ç”±äºæŒ‡é’ˆæœ¬èº«ä¹Ÿæ˜¯å˜é‡ï¼Œæ‰€ä»¥å®ƒä»¬ä¹Ÿå¯ä»¥åƒå…¶å®ƒå˜é‡ä¸€æ ·å­˜å‚¨åœ¨æ•°ç»„ä¸­ã€‚

### 5.6.1 ä¸¾ä¾‹: UNIX ç¨‹åº sort çš„ä¸€ä¸ªç®€åŒ–ç‰ˆæœ¬

è¯¥ç¨‹åº**æŒ‰å­—æ¯é¡ºåºå¯¹ç”±æ–‡æœ¬è¡Œç»„æˆçš„é›†åˆ**è¿›è¡Œæ’åº

**è®¾è®¡æ€æƒ³**:å¦‚æœå¾…æ’åºçš„æ–‡æœ¬è¡Œé¦–å°¾ç›¸è¿åœ°å­˜å‚¨åœ¨ä¸€ä¸ªé•¿å­—ç¬¦æ•°ç»„ä¸­ï¼Œé‚£ä¹ˆæ¯ä¸ªæ–‡æœ¬è¡Œå¯é€šè¿‡æŒ‡å‘å®ƒçš„ç¬¬ä¸€ä¸ªå­—ç¬¦çš„æŒ‡é’ˆæ¥è®¿é—®ã€‚å°†æŒ‡é’ˆæœ¬èº«å­˜å‚¨åœ¨ä¸€ä¸ªæ•°ç»„ä¸­ã€‚è¿™æ ·ï¼Œå°†æŒ‡å‘ä¸¤ä¸ªæ–‡æœ¬è¡Œçš„æŒ‡é’ˆä¼ é€’ç»™å‡½æ•°strcmp å°±å¯å®ç°å¯¹è¿™ä¸¤ä¸ªæ–‡æœ¬è¡Œçš„æ¯”è¾ƒã€‚å½“äº¤æ¢æ¬¡åºé¢ å€’çš„ä¸¤ä¸ªæ–‡æœ¬è¡Œæ—¶ï¼Œå®é™…ä¸Šäº¤æ¢çš„æ˜¯æŒ‡é’ˆæ•°ç»„ä¸­ä¸è¿™ä¸¤ä¸ªæ–‡æœ¬è¡Œç›¸å¯¹åº”çš„æŒ‡é’ˆï¼Œè€Œä¸æ˜¯è¿™ä¸¤ä¸ªæ–‡æœ¬è¡Œæœ¬èº«ã€‚

**ä¼˜ç‚¹**ï¼šæ¶ˆé™¤äº†å› ç§»åŠ¨æ–‡æœ¬è¡Œæœ¬èº«æ‰€å¸¦æ¥çš„å¤æ‚çš„å­˜å‚¨ç®¡ç†å’Œå·¨å¤§çš„å¼€é”€è¿™ä¸¤ä¸ªå­ªç”Ÿé—®é¢˜ã€‚

æ’åºè¿‡ç¨‹åŒ…æ‹¬ä¸‹åˆ— 3 ä¸ªæ­¥éª¤ï¼š

- è¯»å–æ‰€æœ‰è¾“å…¥è¡Œ
- å¯¹æ–‡æœ¬è¡Œè¿›è¡Œæ’åº
- æŒ‰æ¬¡åºæ‰“å°æ–‡æœ¬è¡Œ
  
> **æ•°æ®ç»“æ„ä¸è¾“å…¥å’Œè¾“å‡ºå‡½æ•°**

- è¾“å…¥å‡½æ•°ï¼šæ”¶é›†å’Œä¿å­˜æ¯ä¸ªæ–‡æœ¬è¡Œä¸­çš„å­—ç¬¦ï¼Œå¹¶å»ºç«‹ä¸€ä¸ªæŒ‡å‘è¿™äº›æ–‡æœ¬è¡Œçš„æŒ‡é’ˆçš„æ•°ç»„ã€‚å®ƒåŒæ—¶è¿˜å¿…é¡»ç»Ÿè®¡è¾“å…¥çš„è¡Œæ•°ï¼Œå› ä¸ºåœ¨æ’åºå’Œæ‰“å°æ—¶è¦ç”¨åˆ°è¿™ä¸€ä¿¡æ¯ã€‚ç”±äºè¾“å…¥å‡½æ•°åªèƒ½å¤„ç†æœ‰é™æ•°ç›®çš„è¾“å…¥è¡Œï¼Œæ‰€ä»¥åœ¨è¾“å…¥è¡Œæ•°è¿‡å¤šè€Œè¶…è¿‡é™å®šçš„æœ€å¤§è¡Œæ•°æ—¶ï¼Œè¯¥å‡½æ•°è¿”å›æŸä¸ªç”¨äºè¡¨ç¤ºéæ³•è¡Œæ•°çš„æ•°å€¼ï¼Œä¾‹å¦‚-1ã€‚

- è¾“å‡ºå‡½æ•°ï¼šè¾“å‡ºå‡½æ•°åªéœ€è¦æŒ‰ç…§æŒ‡é’ˆæ•°ç»„ä¸­çš„æ¬¡åºä¾æ¬¡æ‰“å°è¿™äº›æ–‡æœ¬è¡Œå³å¯ã€‚

```c
#include <stdio.h>
#include <string.h>

#define MAXLINES 5000 /* max #lines to be sorted */

char *lineptr[MAXLINES]; /* pointers to text lines */

int readlines(char *lineptr[], int nlines);
void writelines(char *lineptr[], int nlines);
void qsort(char *lineptr[], int left, int right);

/* sort input lines */
main()
{
    int nlines; /* number of input lines read */
    
    if ((nlines = readlines(lineptr, MAXLINES)) >= 0) {
        qsort(lineptr, 0, nlines-1);
        writelines(lineptr, nlines);
        return 0;
    } else {
        printf("error: input too big to sort\n");
        return 1;
    }
}

#define MAXLEN 1000 /* max length of any input line */

int getline(char *, int);
char *alloc(int);

/* readlines: read input lines */
int readlines(char *lineptr[], int maxlines)
{
    int len, nlines;
    char *p, line[MAXLEN];
    nlines = 0;
    while ((len = getline(line, MAXLEN)) > 0)
        if (nlines >= maxlines || p = alloc(len) == NULL)
            return -1;
        else {
            line[len-1] = '\0'; /* delete newline */
            strcpy(p, line);
            lineptr[nlines++] = p;
        }
    return nlines;
}
/* writelines: write output lines */
void writelines(char *lineptr[], int nlines)
{
    int i;

    for (i = 0; i < nlines; i++)
        printf("%s\n", lineptr[i]);
}
```

- æŒ‡æ•°æ•°ç»„`lineptr`çš„å£°æ˜`char *lineptr[MAXLINES];`
  - è¡¨ç¤º `lineptr` æ˜¯ä¸€ä¸ªå…·æœ‰ `MAXLINES` ä¸ªå…ƒç´ çš„ä¸€ç»´æ•°ç»„ï¼Œå…¶ä¸­æ•°ç»„çš„**æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªæŒ‡å‘å­—ç¬¦ç±»å‹å¯¹è±¡çš„æŒ‡é’ˆ**ã€‚
  - lineptr[i]æ˜¯ä¸€ä¸ªå­—ç¬¦æŒ‡é’ˆï¼Œè€Œ*lineptr[i]æ˜¯è¯¥æŒ‡é’ˆæŒ‡å‘çš„ç¬¬ i ä¸ªæ–‡æœ¬è¡Œçš„é¦–å­—ç¬¦

- ç”±äº lineptr æœ¬èº«æ˜¯ä¸€ä¸ªæ•°ç»„åï¼Œå› æ­¤ï¼Œå¯æŒ‰ç…§å‰é¢ä¾‹å­ä¸­ç›¸åŒçš„æ–¹æ³•å°†å…¶ä½œä¸ºæŒ‡é’ˆä½¿ç”¨

> **æ–‡æœ¬æ’åº**

```c
/* qsort: sort v[left]...v[right] into increasing order */
void qsort(char *v[], int left, int right)
{
    int i, last;
    void swap(char *v[], int i, int j);
    if (left >= right) /* do nothing if array contains */
        return; /* fewer than two elements */
    swap(v, left, (left + right)/2);
    last = left;
    for (i = left+1; i <= right; i++)
        if (strcmp(v[i], v[left]) < 0)
            swap(v, ++last, i);
    swap(v, left, last);
    qsort(v, left, last-1);
    qsort(v, last+1, right);
}

/* swap: interchange v[i] and v[j] */
void swap(char *v[], int i, int j)
{
    char *temp;
    temp = v[i];
    v[i] = v[j];
    v[j] = temp;
}
```

å› ä¸º `v`ï¼ˆåˆ«åä¸º `lineptr`ï¼‰çš„æ‰€æœ‰å…ƒç´ éƒ½æ˜¯å­—ç¬¦æŒ‡é’ˆï¼Œå¹¶ä¸” `temp` ä¹Ÿå¿…é¡»æ˜¯å­—ç¬¦æŒ‡é’ˆï¼Œå› æ­¤`temp` ä¸ `v` çš„ä»»æ„å…ƒç´ ä¹‹é—´å¯ä»¥äº’ç›¸å¤åˆ¶ã€‚

***

## 5.7 Multi-dimensional Arrays

C è¯­è¨€æä¾›äº†ç±»ä¼¼äºçŸ©é˜µçš„å¤šç»´æ•°ç»„ï¼Œä½†å®é™…ä¸Šå®ƒä»¬å¹¶ä¸åƒæŒ‡é’ˆæ•°ç»„ä½¿ç”¨å¾—é‚£æ ·å¹¿æ³›.

äºŒç»´æ•°ç»„å®é™…ä¸Šæ˜¯ä¸€ç§ç‰¹æ®Šçš„ä¸€ç»´æ•°ç»„ï¼Œå®ƒçš„æ¯ä¸ªå…ƒç´ ä¹Ÿæ˜¯ä¸€ä¸ªä¸€ç»´æ•°ç»„ã€‚å› æ­¤ï¼Œæ•°ç»„ä¸‹æ ‡åº”è¯¥å†™æˆ

```c
daytab[i][j] /* [row][col] */

daytab[i,j] /* WRONG */
```

æ•°ç»„å¯ä»¥ç”¨èŠ±æ‹¬å·æ‹¬èµ·æ¥çš„åˆå€¼è¡¨è¿›è¡Œ**åˆå§‹åŒ–**ï¼ŒäºŒç»´æ•°ç»„çš„æ¯ä¸€è¡Œç”±ç›¸åº”çš„å­åˆ—è¡¨è¿›è¡Œåˆå§‹åŒ–ã€‚
ä¸€èˆ¬æ¥è¯´ï¼Œé™¤æ•°ç»„çš„ç¬¬ä¸€ç»´ï¼ˆä¸‹æ ‡ï¼‰å¯ä»¥ä¸æŒ‡å®šå¤§å°å¤–ï¼Œ**å…¶ä½™å„ç»´éƒ½å¿…é¡»æ˜ç¡®æŒ‡å®šå¤§å°**ã€‚

```c
static char daytab[2][13] = {
    {0, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31},
    {0, 31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31}
};
```

å¦‚æœ**å°†äºŒç»´æ•°ç»„ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°**ï¼Œé‚£ä¹ˆåœ¨å‡½æ•°çš„å‚æ•°å£°æ˜ä¸­**å¿…é¡»æŒ‡æ˜æ•°ç»„çš„åˆ—æ•°**ã€‚

æ•°ç»„çš„è¡Œæ•°æ²¡æœ‰å¤ªå¤§å…³ç³»ï¼Œå› ä¸ºå‰é¢å·²ç»è®²è¿‡ï¼Œå‡½æ•°è°ƒç”¨æ—¶ä¼ é€’çš„æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒæŒ‡å‘ç”±è¡Œå‘é‡æ„æˆçš„ä¸€ç»´æ•°ç»„ï¼Œå…¶ä¸­æ¯ä¸ªè¡Œå‘é‡æ˜¯å…·æœ‰ 13 ä¸ªæ•´å‹å…ƒç´ çš„ä¸€ç»´æ•°ç»„ã€‚å› æ­¤ï¼Œå¦‚æœå°†æ•°ç»„ `daytab` ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•° fï¼Œé‚£ä¹ˆ f çš„å£°æ˜åº”è¯¥å†™æˆä¸‹åˆ—å½¢å¼ï¼š

```c
f(int daytab[2][13]) { ... }
//ä¹Ÿå¯ä»¥å†™æˆ
f(int daytab[][13]) { ... }
//å› ä¸ºæ•°ç»„çš„è¡Œæ•°æ— å…³ç´§è¦ï¼Œæ‰€ä»¥ï¼Œè¯¥å£°æ˜è¿˜å¯ä»¥å†™æˆ
/*è¡¨æ˜å½¢å‚æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒæŒ‡å‘å…·æœ‰13ä¸ªæ•´å‹å…ƒç´ çš„ä¸€ç»´æ•°ç»„*/
f(int (*daytab)[13]) { ... }
/*å› ä¸ºæ–¹æ‹¬å·[]çš„ä¼˜å…ˆçº§é«˜äº*çš„ä¼˜å…ˆçº§ï¼Œæ‰€ä»¥ä¸Šè¿°å£°æ˜ä¸­å¿…é¡»ä½¿ç”¨åœ†æ‹¬å·ã€‚ */
int *daytab[13];//è¿™ç›¸å½“äºå£°æ˜äº†ä¸€ä¸ªæ•°ç»„ï¼Œè¯¥æ•°ç»„æœ‰ 13 ä¸ªå…ƒç´ ï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘æ•´å‹å¯¹è±¡çš„æŒ‡é’ˆã€‚
```

***

## 5.8 Initialization of Pointers Arrays

æŒ‡é’ˆæ•°ç»„çš„åˆå§‹åŒ–è¯­æ³•å’Œå‰é¢æ‰€è®²çš„å…¶å®ƒç±»å‹å¯¹è±¡çš„åˆå§‹åŒ–è¯­æ³•ç±»ä¼¼ï¼š

```c
/* month_name: return name of n-th month */
char *month_name(int n)
{
    static char *name[] = {
        "Illegal month",
        "January", "February", "March",
        "April", "May", "June",
        "July", "August", "September",
        "October", "November", "December"
    };
```

- `name`å£°æ˜æ˜¯ä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼Œæ•°ç»„çš„å…ƒç´ ä¸ºå­—ç¬¦æŒ‡é’ˆã€‚
- `name`æ•°ç»„çš„**åˆå§‹åŒ–**é€šè¿‡ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨å®ç°ï¼Œåˆ—è¡¨ä¸­çš„æ¯ä¸ªå­—ç¬¦ä¸²èµ‹å€¼ç»™æ•°ç»„ç›¸åº”ä½ç½®çš„å…ƒç´ 
- ç¬¬ i ä¸ªå­—ç¬¦ä¸²çš„æ‰€æœ‰å­—ç¬¦å­˜å‚¨åœ¨å­˜å‚¨å™¨ä¸­çš„æŸä¸ªä½ç½®ï¼ŒæŒ‡å‘**å­—ç¬¦ä¸²çš„æŒ‡é’ˆ**å­˜å‚¨åœ¨name[i]ä¸­ã€‚
- ç”±äºä¸Šè¿°å£°æ˜ä¸­æ²¡æœ‰æŒ‡æ˜ `name` çš„é•¿åº¦ï¼Œå› æ­¤ï¼Œç¼–è¯‘å™¨ç¼–è¯‘æ—¶å°†å¯¹åˆå€¼ä¸ªæ•°è¿›è¡Œç»Ÿè®¡ï¼Œå¹¶å°†è¿™ä¸€å‡†ç¡®æ•°å­—å¡«å…¥æ•°ç»„çš„é•¿åº¦ã€‚

***

## 5.9 Pointers vs Multi-dimensional Arrays

å¯¹äº C è¯­è¨€çš„åˆå­¦è€…æ¥è¯´ï¼Œå¾ˆå®¹æ˜“æ··æ·†**äºŒç»´æ•°ç»„**ä¸**æŒ‡é’ˆæ•°ç»„**ä¹‹é—´çš„åŒºåˆ«

```c
int a[10][20];
int *b[10];
```

- å¯¹äºä¸Šè¿°å®šä¹‰ï¼Œä»è¯­æ³•è§’åº¦è€Œè¨€`a[3][4]`å’Œ `b[3][4]`éƒ½æ˜¯å¯¹ä¸€ä¸ª`int` å¯¹è±¡çš„åˆæ³•å¼•ç”¨ã€‚

- `a` æ˜¯ä¸€ä¸ªçœŸæ­£çš„äºŒç»´æ•°ç»„ï¼Œå®ƒåˆ†é…äº† `200` ä¸ª `int` ç±»å‹é•¿åº¦çš„å­˜å‚¨ç©ºé—´ï¼Œå¹¶ä¸”é€šè¿‡å¸¸è§„çš„çŸ©é˜µä¸‹æ ‡è®¡ç®—å…¬å¼ `20Ã—row+col`ï¼ˆå…¶ä¸­ï¼Œ`row` è¡¨ç¤ºè¡Œï¼Œ`col` è¡¨ç¤ºåˆ—ï¼‰è®¡ç®—å¾—åˆ°å…ƒç´ `a[row][col]`çš„ä½ç½®ã€‚
- å¯¹ `b` æ¥è¯´ï¼Œè¯¥å®šä¹‰ä»…ä»…åˆ†é…äº† `10` ä¸ªæŒ‡é’ˆï¼Œå¹¶ä¸”æ²¡æœ‰å¯¹å…¶åˆå§‹åŒ–ï¼Œå®ƒä»¬çš„åˆå§‹åŒ–å¿…é¡»ä»¥**æ˜¾å¼çš„æ–¹å¼è¿›è¡Œ**ï¼Œæ¯”å¦‚é™æ€åˆå§‹åŒ–æˆ–é€šè¿‡ä»£ç åˆå§‹åŒ–ã€‚å‡å®š `b` çš„æ¯ä¸ªå…ƒç´ éƒ½æŒ‡å‘ä¸€ä¸ªå…·æœ‰ `20` ä¸ªå…ƒç´ çš„æ•°ç»„ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å°±è¦ä¸ºå®ƒåˆ†é… `200` ä¸ª `int` ç±»å‹é•¿åº¦çš„å­˜å‚¨ç©ºé—´ä»¥åŠ `10` ä¸ªæŒ‡é’ˆçš„å­˜å‚¨ç©ºé—´ã€‚
- æŒ‡é’ˆæ•°ç»„çš„ä¸€ä¸ª**é‡è¦ä¼˜ç‚¹åœ¨äº**ï¼Œæ•°ç»„çš„æ¯ä¸€è¡Œé•¿åº¦å¯ä»¥ä¸åŒï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œb çš„æ¯ä¸ªå…ƒç´ ä¸å¿…éƒ½æŒ‡å‘ä¸€ä¸ªå…·æœ‰ 20 ä¸ªå…ƒç´ çš„å‘é‡ï¼ŒæŸäº›å…ƒç´ å¯ä»¥æŒ‡å‘å…·æœ‰ 2 ä¸ªå…ƒç´ çš„å‘é‡ï¼ŒæŸäº›å…ƒç´ å¯ä»¥æŒ‡å‘å…·æœ‰ 50 ä¸ªå…ƒç´ çš„å‘é‡ï¼Œè€ŒæŸäº›å…ƒç´ å¯ä»¥ä¸æŒ‡å‘ä»»ä½•å‘é‡ã€‚

***

## 5.10 Command-line Arguments

### 5.10.1 æ¦‚è¿°

åœ¨æ”¯æŒ C è¯­è¨€çš„ç¯å¢ƒä¸­ï¼Œå¯ä»¥**åœ¨ç¨‹åºå¼€å§‹æ‰§è¡Œæ—¶å°†å‘½ä»¤è¡Œå‚æ•°ä¼ é€’ç»™ç¨‹åº**ã€‚

è°ƒç”¨ä¸»å‡½æ•°main æ—¶ï¼Œå®ƒå¸¦æœ‰ä¸¤ä¸ªå‚æ•°ã€‚

- ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆä¹ æƒ¯ä¸Šç§°ä¸º `argc`ï¼Œç”¨äºå‚æ•°è®¡æ•°ï¼‰çš„å€¼è¡¨ç¤º**è¿è¡Œç¨‹åºæ—¶å‘½ä»¤è¡Œä¸­å‚æ•°çš„æ•°ç›®**ï¼›
  
- ç¬¬äºŒä¸ªå‚æ•°ï¼ˆç§°ä¸º `argv`ï¼Œç”¨äºå‚æ•°å‘é‡ï¼‰æ˜¯ä¸€ä¸ª**æŒ‡å‘å­—ç¬¦ä¸²æ•°ç»„çš„æŒ‡é’ˆ**ï¼Œå…¶ä¸­**æ¯ä¸ªå­—ç¬¦ä¸²å¯¹åº”ä¸€ä¸ªå‚æ•°**ã€‚æˆ‘ä»¬é€šå¸¸ç”¨å¤šçº§æŒ‡é’ˆå¤„ç†è¿™äº›å­—ç¬¦ä¸²ã€‚

- æŒ‰ç…§ C è¯­è¨€çš„çº¦å®š,`argv[0]`çš„å€¼æ˜¯å¯åŠ¨è¯¥ç¨‹åºçš„ç¨‹åºåï¼Œå› æ­¤ `argc` çš„å€¼è‡³å°‘ä¸º `1`ã€‚å¦‚æœ `argc` çš„å€¼ä¸º `1`ï¼Œåˆ™è¯´æ˜ç¨‹åºååé¢æ²¡æœ‰å‘½ä»¤è¡Œå‚æ•°ã€‚

- ç¬¬ä¸€ä¸ªå¯é€‰å‚æ•°ä¸º `argv[1]`ï¼Œè€Œæœ€åä¸€ä¸ªå¯é€‰å‚æ•°ä¸º `argv[argc-1]`ã€‚å¦å¤–ï¼ŒANSI æ ‡å‡†è¦æ±‚
`argv[argc]`çš„å€¼å¿…é¡»ä¸ºä¸€ç©ºæŒ‡é’ˆ

### 5.10.2 echo

> **ç¬¬ä¸€ä¸ªç‰ˆæœ¬:å°† argv çœ‹æˆæ˜¯ä¸€ä¸ªå­—ç¬¦æŒ‡é’ˆæ•°ç»„**

```c
#include <stdio.h>
/* echo command-line arguments; 1st version */
main(int argc, char *argv[])
{
    int i;
    for (i = 1; i < argc; i++)
    printf("%s%s", argv[i], (i < argc-1) ? " " : "");
    printf("\n");
    return 0;
}
```

> **ç¬¬äºŒä¸ªç‰ˆæœ¬**

åœ¨å¯¹ `argv` è¿›è¡Œè‡ªå¢è¿ç®—ã€å¯¹ `argc` è¿›è¡Œè‡ªå‡è¿ç®—çš„åŸºç¡€ä¸Šå®ç°çš„ï¼Œå…¶ä¸­ `argv` æ˜¯ä¸€ä¸ªæŒ‡å‘ `char` ç±»å‹çš„æŒ‡é’ˆçš„æŒ‡é’ˆ

```c
#include <stdio.h>
/* echo command-line arguments; 2nd version */
main(int argc, char *argv[])
{
    while (--argc > 0)
        printf("%s%s", *++argv, (argc > 1) ? " " : "");
        printf("\n");
    return 0;
}
```

- `argv` æ˜¯ä¸€ä¸ªæŒ‡å‘å‚æ•°å­—ç¬¦ä¸²æ•°ç»„èµ·å§‹ä½ç½®çš„æŒ‡é’ˆï¼Œè‡ªå¢è¿ç®—ï¼ˆ`++argv`ï¼‰å°†ä½¿å¾—å®ƒåœ¨æœ€å¼€å§‹æŒ‡å‘ `argv[1]`è€Œé `argv[0]`ã€‚`*argv` å°±æ˜¯æŒ‡å‘é‚£ä¸ªå‚æ•°çš„æŒ‡é’ˆã€‚

### 5.10.3 æ¨¡å¼æŸ¥æ‰¾ç¨‹åº

> **ç¬¬ä¸€ä¸ªç‰ˆæœ¬**

```c
#include <stdio.h>
#include <string.h>
#define MAXLINE 1000
int getline(char *line, int max);
/* find: print lines that match pattern from 1st arg */
main(int argc, char *argv[])
{
    char line[MAXLINE];
    int found = 0;
    if (argc != 2)
        printf("Usage: find pattern\n");
    else
        while (getline(line, MAXLINE) > 0)
        if (strstr(line, argv[1]) != NULL) {
            printf("%s", line);
            found++;
    }
    return found;
}
```

æ ‡å‡†åº“å‡½æ•° `strstr(s, t)`è¿”å›ä¸€ä¸ªæŒ‡é’ˆï¼Œè¯¥æŒ‡é’ˆæŒ‡å‘å­—ç¬¦ä¸² `t` åœ¨å­—ç¬¦ä¸² `s` ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼›å¦‚æœå­—ç¬¦ä¸² `t` æ²¡æœ‰åœ¨å­—ç¬¦ä¸² `s` ä¸­å‡ºç°ï¼Œå‡½æ•°è¿”å› `NULL`ï¼ˆç©ºæŒ‡é’ˆï¼‰ã€‚è¯¥å‡½æ•°å£°æ˜åœ¨å¤´æ–‡ä»¶`<string.h>`ä¸­ã€‚

> **æ”¹è¿›ç‰ˆæœ¬**

å‡å®šå…è®¸ç¨‹åºå¸¦ä¸¤ä¸ªå¯é€‰å‚æ•°ã€‚

- å…¶ä¸­ä¸€ä¸ªå‚æ•°è¡¨ç¤ºâ€œæ‰“å°é™¤åŒ¹é…æ¨¡å¼ä¹‹å¤–çš„æ‰€æœ‰è¡Œâ€
- å¦ä¸€ä¸ªå‚æ•°è¡¨ç¤ºâ€œæ¯ä¸ªæ‰“å°çš„æ–‡æœ¬è¡Œå‰é¢åŠ ä¸Šç›¸åº”çš„è¡Œå·â€

UNIX ç³»ç»Ÿä¸­çš„ C è¯­è¨€ç¨‹åºæœ‰ä¸€ä¸ª**å…¬å…±çš„çº¦å®š**ï¼š**ä»¥è´Ÿå·å¼€å¤´çš„å‚æ•°è¡¨ç¤ºä¸€ä¸ªå¯é€‰æ ‡å¿—æˆ–å‚æ•°**ã€‚

- ç”¨`-x`ï¼ˆä»£è¡¨â€œé™¤â€¦â€¦ä¹‹å¤–â€ï¼‰è¡¨ç¤ºæ‰“å°æ‰€æœ‰ä¸æ¨¡å¼ä¸åŒ¹é…çš„æ–‡æœ¬è¡Œï¼Œ
- ç”¨`-n`ï¼ˆä»£è¡¨â€œè¡Œå·â€ï¼‰è¡¨ç¤ºæ‰“å°è¡Œå·

é‚£ä¹ˆå‘½ä»¤ï¼š`find -x -n æ¨¡å¼`å°†æ‰“å°æ‰€æœ‰ä¸æ¨¡å¼ä¸åŒ¹é…çš„è¡Œï¼Œå¹¶åœ¨æ¯ä¸ªæ‰“å°è¡Œçš„å‰é¢åŠ ä¸Šè¡Œå·ã€‚

**å¯é€‰å‚æ•°åº”è¯¥å…è®¸ä»¥ä»»æ„æ¬¡åºå‡ºç°**ï¼ŒåŒæ—¶ï¼Œç¨‹åºçš„å…¶ä½™éƒ¨åˆ†åº”è¯¥ä¸å‘½ä»¤è¡Œä¸­å‚æ•°çš„æ•°ç›®æ— å…³ã€‚æ­¤å¤–ï¼Œå¦‚æœå¯é€‰å‚æ•°èƒ½å¤Ÿç»„åˆä½¿ç”¨ï¼Œå°†ä¼šç»™ä½¿ç”¨è€…å¸¦æ¥æ›´å¤§çš„æ–¹ä¾¿ï¼Œæ¯”å¦‚ï¼š`find -nx æ¨¡å¼`

```c
#include <stdio.h>
#include <string.h>
#define MAXLINE 1000
int getline(char *line, int max);
/* find: print lines that match pattern from 1st arg */
main(int argc, char *argv[])
{
    char line[MAXLINE];
    long lineno = 0;
    int c, except = 0, number = 0, found = 0;
    while (--argc > 0 && (*++argv)[0] == '-')
        while (c = *++argv[0])
        switch (c) {
            case 'x':
                except = 1;
                break;
            case 'n':
                number = 1;
                break;
            default:
                printf("find: illegal option %c\n", c);
                argc = 0;
                found = -1;
                break;
            }
    if (argc != 1)
        printf("Usage: find -x -n pattern\n");
    else
        while (getline(line, MAXLINE) > 0) {
            lineno++;
            if ((strstr(line, *argv) != NULL) != except) {
                if (number)
                    printf("%ld:", lineno);
                printf("%s", line);
                found++;
        }
    }
    return found;
}
```

- `argc` æ‰§è¡Œè‡ªå‡è¿ç®—ï¼Œ`argv` æ‰§è¡Œè‡ªå¢è¿ç®—ã€‚å¾ªç¯è¯­å¥ç»“æŸæ—¶ï¼Œå¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œåˆ™ `argc` çš„å€¼è¡¨ç¤ºè¿˜æ²¡æœ‰å¤„ç†çš„å‚æ•°æ•°ç›®ï¼Œè€Œ `argv` åˆ™æŒ‡å‘è¿™äº›æœªå¤„ç†å‚æ•°ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚
- æ³¨æ„ï¼Œ`*++argv` æ˜¯ä¸€ä¸ªæŒ‡å‘å‚æ•°å­—ç¬¦ä¸²çš„æŒ‡å¼•ï¼Œå› æ­¤`(*++argv)[0]`æ˜¯å®ƒçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼ˆå¦ä¸€ç§æœ‰æ•ˆå½¢å¼æ˜¯`**++argv`ï¼‰ã€‚å› ä¸º **`[]`ä¸æ“ä½œæ•°çš„ç»“åˆä¼˜å…ˆçº§æ¯”`*`å’Œ`++`é«˜**ï¼Œæ‰€ä»¥åœ¨ä¸Šè¿°è¡¨è¾¾å¼ä¸­å¿…é¡»ä½¿ç”¨åœ†æ‹¬å·ï¼Œå¦åˆ™ç¼–è¯‘å™¨å°†ä¼šæŠŠè¯¥è¡¨è¾¾å¼å½“åš`*++(argv[0])`ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬åœ¨å†…å±‚å¾ªç¯ä¸­å°±ä½¿ç”¨äº†è¡¨è¾¾å¼`*++argv[0]`ï¼Œå…¶ç›®çš„æ˜¯éå†ä¸€ä¸ªç‰¹å®šçš„å‚æ•°ä¸²ã€‚åœ¨å†…å±‚å¾ªç¯ä¸­ï¼Œè¡¨è¾¾å¼`*++argv[0]`å¯¹æŒ‡é’ˆ `argv[0]`è¿›è¡Œäº†è‡ªå¢è¿ç®—

***

## 5.11 Pointers to Functions

åœ¨ C è¯­è¨€ä¸­ï¼Œ**å‡½æ•°æœ¬èº«ä¸æ˜¯å˜é‡**ï¼Œä½†å¯ä»¥**å®šä¹‰æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆ**ã€‚è¿™ç§ç±»å‹çš„æŒ‡é’ˆå¯ä»¥è¢«èµ‹å€¼ã€å­˜æ”¾åœ¨æ•°ç»„ä¸­ã€ä¼ é€’ç»™å‡½æ•°ä»¥åŠä½œä¸ºå‡½æ•°çš„è¿”å›å€¼ç­‰ç­‰

> **ä»¥æ’åºå‡½æ•°ä¸ºä¾‹è¯´æ˜æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆçš„ç”¨æ³•**

é€šè¿‡åœ¨æ’åºç®—æ³•ä¸­è°ƒç”¨ä¸åŒçš„æ¯”è¾ƒå’Œäº¤æ¢å‡½æ•°ï¼Œä¾¿å¯ä»¥å®
ç°æŒ‰ç…§ä¸åŒçš„æ ‡å‡†æ’åºã€‚

```c
#include <stdio.h>
#include <string.h>

#define MAXLINES 5000 /* max #lines to be sorted */
char *lineptr[MAXLINES]; /* pointers to text lines */

int readlines(char *lineptr[], int nlines);
void writelines(char *lineptr[], int nlines);

void qsort(void *lineptr[], int left, int right, int (*comp)(void *, void *));

int numcmp(char *, char *);

/* sort input lines */
main(int argc, char *argv[])
{
    int nlines; /* number of input lines read */
    int numeric = 0; /* 1 if numeric sort */
    if (argc > 1 && strcmp(argv[1], "-n") == 0)
        numeric = 1;
    if ((nlines = readlines(lineptr, MAXLINES)) >= 0) {
        qsort((void**) lineptr, 0, nlines-1, (int (*)(void*,void*))(numeric ? numcmp : strcmp));
        writelines(lineptr, nlines);
        return 0;
    } else {
        printf("input too big to sort\n");
        return 1;
    }
}
```

åœ¨è°ƒç”¨å‡½æ•° `qsort` çš„è¯­å¥ä¸­ï¼Œ`strcmp`å’Œ `numcmp` æ˜¯å‡½æ•°çš„åœ°å€ã€‚å› ä¸ºå®ƒä»¬æ˜¯å‡½æ•°ï¼Œæ‰€ä»¥å‰é¢ä¸éœ€è¦åŠ ä¸Šå–åœ°å€è¿ç®—ç¬¦`&`ï¼ŒåŒæ ·çš„åŸå› ï¼Œæ•°ç»„åå‰é¢ä¹Ÿä¸éœ€è¦&è¿ç®—ç¬¦ã€‚

**qsortå‡½æ•°ï¼š**

```c
/**
*@breif:sort v[left]...v[right] into increasing order
*@param:
*@param: int (*comp)(void *, void *),è¡¨æ˜ comp æ˜¯ä¸€ä¸ªæŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆï¼Œè¯¥å‡½æ•°å…·æœ‰ä¸¤ä¸ª void *ç±»å‹çš„å‚æ•°ï¼Œå…¶è¿”å›å€¼ç±»å‹ä¸º
intã€‚
 */
void qsort(void *v[], int left, int right, int (*comp)(void *, void *))
{
    int i, last;
    void swap(void *v[], int, int);
    if (left >= right) /* do nothing if array contains */
        return; /* fewer than two elements */
    swap(v, left, (left + right)/2);
    last = left;
    for (i = left+1; i <= right; i++)
        if ((*comp)(v[i], v[left]) < 0)
            swap(v, ++last, i);
    swap(v, left, last);
    qsort(v, left, last-1, comp);
    qsort(v, last+1, right, comp);
}

```

> **æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆcomçš„å£°æ˜**
qsort å‡½æ•°çš„ç¬¬å››ä¸ªå‚æ•°å£°æ˜å¦‚ä¸‹ï¼š

```c
int (*comp)(void *, void *)
```

å®ƒè¡¨æ˜ `comp` æ˜¯ä¸€ä¸ªæŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆï¼Œè¯¥å‡½æ•°å…·æœ‰ä¸¤ä¸ª`void *`ç±»å‹çš„å‚æ•°ï¼Œå…¶è¿”å›å€¼ç±»å‹ä¸º`int`.

> **comçš„ä½¿ç”¨**

`comp` æ˜¯ä¸€ä¸ªæŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆï¼Œ`*comp` ä»£è¡¨ä¸€ä¸ªå‡½æ•°ã€‚ä¸‹åˆ—è¯­å¥æ˜¯å¯¹è¯¥å‡½æ•°è¿›è¡Œè°ƒç”¨ï¼š

```c
(*comp)(v[i], v[left]);
```

å…¶ä¸­çš„åœ†æ‹¬å·æ˜¯å¿…é¡»çš„ï¼Œè¿™æ ·æ‰èƒ½å¤Ÿä¿è¯å…¶ä¸­çš„å„ä¸ªéƒ¨åˆ†æ­£ç¡®ç»“åˆã€‚å¦‚æœæ²¡æœ‰æ‹¬å·ï¼Œä¾‹å¦‚å†™æˆä¸‹é¢çš„å½¢å¼ï¼š

```c
/*åˆ™è¡¨æ˜ comp æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å›ä¸€ä¸ªæŒ‡å‘ int ç±»å‹çš„æŒ‡é’ˆ */
int *comp(void *, void *) /* WRONG */
```

***

## 5.12 Complicated Declarations

å¯¹äºç®€å•çš„æƒ…å†µï¼Œ`C` è¯­è¨€çš„åšæ³•æ˜¯å¾ˆæœ‰æ•ˆçš„ï¼Œä½†æ˜¯ï¼Œå¦‚æœæƒ…å†µæ¯”è¾ƒå¤æ‚ï¼Œåˆ™å®¹æ˜“è®©äººæ··æ·†ï¼ŒåŸå› åœ¨äºï¼Œ`C` è¯­è¨€çš„å£°æ˜ä¸èƒ½ä»å·¦è‡³å³é˜…è¯»ï¼Œè€Œä¸”ä½¿ç”¨äº†å¤ªå¤šçš„åœ†æ‹¬å·ã€‚

> **ä¸¾ä¾‹**

*æ˜¯ä¸€ä¸ªå‰ç¼€è¿ç®—ç¬¦ï¼Œå…¶ä¼˜å…ˆçº§ä½äº()ï¼Œæ‰€ä»¥ï¼Œå£°æ˜ä¸­å¿…é¡»ä½¿ç”¨åœ†æ‹¬å·ä»¥ä¿æ­£ç¡®çš„ç»“åˆé¡ºåº

```c
int *f(); /* è¿”å›intæŒ‡é’ˆç±»å‹çš„å‡½æ•° */

int (*pf)(); /* æŒ‡å‘è¿”å›intç±»å‹çš„å‡½æ•°æŒ‡é’ˆ */
```

> **å¦‚ä½•åˆ›å»ºå¤æ‚çš„å£°æ˜**

- æ–¹æ³•ä¸€:ä½¿ç”¨ `typedef` é€šè¿‡ç®€å•çš„æ­¥éª¤åˆæˆï¼Œè¿™ç§æ–¹æ³•æˆ‘ä»¬å°†åœ¨ 6.7 èŠ‚ä¸­è®¨è®º;
- æ–¹æ³•äºŒ:ç¼–å†™ç¨‹åº
  - ä¸€ä¸ªç¨‹åºç”¨äºå°†æ­£ç¡®çš„ C è¯­è¨€å£°æ˜è½¬æ¢ä¸ºæ–‡å­—æè¿°
  - å¦ä¸€ä¸ªç¨‹åºå®Œæˆç›¸åçš„è½¬æ¢ã€‚

> **ç¨‹åºdcl:å°†Cè¯­è¨€å£°æ˜è½¬æ¢ä¸ºæ–‡å­—æè¿°**


```c
char **argv
    argv: pointer to char
int (*daytab)[13]
    daytab: pointer to array[13] of int
int *daytab[13]
    daytab: array[13] of pointer to int
void *comp()
    comp: function returning pointer to void
void (*comp)()
    comp: pointer to function returning void
char (*(*x())[])()
    x: function returning pointer to array[] of
    pointer to function returning char
char (*(*x[3])())[5]
    x: array[3] of pointer to function returning
    pointer to array[5] of char
```

ç¨‹åº `dcl` æ˜¯åŸºäºå£°æ˜ç¬¦çš„è¯­æ³•ç¼–å†™çš„,ä¸‹è¿°ä¸ºç®€åŒ–çš„è¯­æ³•å½¢å¼ï¼š

```c
dcl: optional *'s direct-dcl
direct-dcl name
    (dcl)
    direct-dcl()
    direct-dcl[optional size]
```

å£°æ˜ç¬¦ `dcl` å°±æ˜¯å‰é¢å¯èƒ½å¸¦æœ‰å¤šä¸ª`*`çš„ `direct-dcl`ã€‚è¯¥è¯­æ³•å¯ç”¨æ¥å¯¹ C è¯­è¨€çš„å£°æ˜è¿›è¡Œåˆ†æ.`direct-dcl` å¯ä»¥æ˜¯:

- `name`
- ç”±ä¸€å¯¹åœ†æ‹¬å·æ‹¬èµ·æ¥çš„ `dcl`
- åé¢è·Ÿæœ‰ä¸€å¯¹åœ†æ‹¬å·çš„ `direct-dcl`
- åé¢è·Ÿæœ‰ç”¨æ–¹æ‹¬å·æ‹¬èµ·æ¥çš„è¡¨ç¤ºå¯é€‰é•¿åº¦çš„ `direct-dcl`ã€‚

ä¾‹å¦‚å¯¹å£°æ˜ç¬¦`(*pfa[])()`æŒ‰ç…§è¯­æ³•åˆ†æï¼š

- `pfa` å°†è¢«è¯†åˆ«ä¸ºä¸€ä¸ª `name`ï¼Œä»è€Œè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ª `direct-dcl`ã€‚
- äºæ˜¯ï¼Œ`pfa[]`ä¹Ÿæ˜¯ä¸€ä¸ª `direct-dcl`ã€‚
- æ¥ç€ï¼Œ`*pfa[]`è¢«è¯†åˆ«ä¸ºä¸€ä¸ª `dcl`ï¼Œå› æ­¤ï¼Œåˆ¤å®š`(*pfa[])`æ˜¯ä¸€ä¸ª `direct-dcl`ã€‚
- å†æ¥ç€ï¼Œ`(*pfa[])()`è¢«è¯†åˆ«ä¸ºä¸€ä¸ª `direct-dcl`ï¼Œå› æ­¤ä¹Ÿæ˜¯ä¸€ä¸ª `dcl`ã€‚

![](https://s2.51cto.com/images/blog/202207/12145706_62cd1b42dd17367087.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_30,g_se,x_10,y_10,shadow_20,type_ZmFuZ3poZW5naGVpdGk=/format,webp/resize,m_fixed,w_1184)

ç¨‹åº dcl çš„æ ¸å¿ƒæ˜¯ä¸¤ä¸ªå‡½æ•°ï¼š**dcl ä¸ dirdcl**ï¼Œå®ƒä»¬æ ¹æ®å£°æ˜ç¬¦çš„è¯­æ³•å¯¹å£°æ˜è¿›è¡Œåˆ†æã€‚

å› ä¸ºè¯­æ³•æ˜¯é€’å½’å®šä¹‰çš„ï¼Œæ‰€ä»¥åœ¨è¯†åˆ«ä¸€ä¸ªå£°æ˜çš„ç»„æˆéƒ¨åˆ†æ—¶ï¼Œ**è¿™ä¸¤ä¸ªå‡½æ•°æ˜¯ç›¸äº’é€’å½’è°ƒç”¨çš„**ã€‚æˆ‘ä»¬ç§°è¯¥ç¨‹åºæ˜¯ä¸€ä¸ª**é€’å½’ä¸‹é™è¯­æ³•åˆ†æç¨‹åº**

```c
/* dcl: parse a declarator */
void dcl(void)
{
    int ns;
    for (ns = 0; gettoken() == '*'; ) /* count *'s */
        ns++;
    dirdcl();
    while (ns-- > 0)
        strcat(out, " pointer to");
}
/* dirdcl: parse a direct declarator */
void dirdcl(void)
{
    int type;
    if (tokentype == '(') { /* ( dcl ) */
        dcl();
        if (tokentype != ')')
        printf("error: missing )\n");
    } else if (tokentype == NAME) /* variable name */
        strcpy(name, token);
    else
        printf("error: expected name or (dcl)\n");
    while ((type=gettoken()) == PARENS || type == BRACKETS)
        if (type == PARENS)
            strcat(out, " function returning");
        else {
            strcat(out, " array");
            strcat(out, token);
            strcat(out, " of");
    }
}
```

ç¨‹åºçš„å…¨å±€å˜é‡å’Œä¸»ç¨‹åº

```c
#include <stdio.h>
#include <string.h>
#include <ctype.h>
#define MAXTOKEN 100
enum { NAME, PARENS, BRACKETS };
void dcl(void);
void dirdcl(void);
int gettoken(void);
int tokentype; /* type of last token */
char token[MAXTOKEN]; /* last token string */
char name[MAXTOKEN]; /* identifier name */
char datatype[MAXTOKEN]; /* data type = char, int, etc. */
char out[1000];
main() /* convert declaration to words */
{
    while (gettoken() != EOF) { /* 1st token on line */
        strcpy(datatype, token); /* is the datatype */
        out[0] = '\0';
        dcl(); /* parse rest of line */
        if (tokentype != '\n')
            printf("syntax error\n");
        printf("%s: %s %s\n", name, out, datatype);
    }
    return 0;
}
```

å‡½æ•° `gettoken` ç”¨æ¥è·³è¿‡ç©ºæ ¼ä¸åˆ¶è¡¨ç¬¦ï¼Œä»¥æŸ¥æ‰¾è¾“å…¥ä¸­çš„ä¸‹ä¸€ä¸ªè®°å·

â€œè®°å·â€ï¼ˆtokenï¼‰å¯ä»¥æ˜¯:

- ä¸€ä¸ªåå­—
- ä¸€å¯¹åœ†æ‹¬å·
- å¯èƒ½åŒ…å«ä¸€ä¸ªæ•°å­—çš„ä¸€å¯¹æ–¹æ‹¬å·
- ä¹Ÿå¯ä»¥æ˜¯å…¶å®ƒä»»ä½•å•ä¸ªå­—ç¬¦ã€‚

```c
int gettoken(void) /* return next token */
{
    int c, getch(void);
    void ungetch(int);
    char *p = token;
    while ((c = getch()) == ' ' || c == '\t')
        ;
    if (c == '(') {
        if ((c = getch()) == ')') {
            strcpy(token, "()");
            return tokentype = PARENS;
        } else {
            ungetch(c);
            return tokentype = '(';
        }
    } else if (c == '[') {
        for (*p++ = c; (*p++ = getch()) != ']'; )
            ;
        *p = '\0';
        return tokentype = BRACKETS;
    } else if (isalpha(c)) {
        for (*p++ = c; isalnum(c = getch()); )
            *p++ = c;
        *p = '\0';
        ungetch(c);
        return tokentype = NAME;
    } else
        return tokentype = c;
}
```

> **ç¨‹åº undcl ï¼šç›¸åæ–¹å‘çš„è½¬æ¢**

- ä¸ºäº†ç®€åŒ–ç¨‹åºçš„è¾“å…¥ï¼Œå°†â€œx is a function returning a pointer to an array of pointers to functions returning charâ€ï¼ˆx æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒè¿”å›ä¸€ä¸ªæŒ‡é’ˆï¼Œè¯¥æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼Œè¯¥ä¸€ç»´æ•°ç»„çš„å…ƒç´ ä¸ºæŒ‡é’ˆï¼Œè¿™äº›æŒ‡é’ˆåˆ†åˆ«æŒ‡å‘å¤šä¸ªå‡½æ•°ï¼Œè¿™äº›å‡½æ•°çš„è¿”å›å€¼ä¸º char ç±»å‹ï¼‰çš„æè¿°ç”¨ä¸‹åˆ—å½¢å¼è¡¨ç¤ºï¼š`x () * [] * () char`
- ç¨‹åº undcl å°†æŠŠè¯¥å½¢å¼è½¬æ¢ä¸ºï¼š`char (*(*x())[])()`

```c
/* undcl: convert word descriptions to declarations */
main()
{
    int type;
    char temp[MAXTOKEN];
    while (gettoken() != EOF) {
        strcpy(out, token);
        while ((type = gettoken()) != '\n')
            if (type == PARENS || type == BRACKETS)
                strcat(out, token);
            else if (type == '*') {
                sprintf(temp, "(*%s)", out);
                strcpy(out, temp);
            } else if (type == NAME) {
                sprintf(temp, "%s %s", token, out);
                strcpy(out, temp);
            } else
                printf("invalid input at %s\n", token);
    }
    return 0;
}
```